name: üèóÔ∏è –°–±–æ—Ä–∫–∞ .exe

on:
  push:
    tags:
      - 'v*'

jobs:
  build-exe:
    runs-on: windows-latest
    steps:
      - name: üîπ Checkout
        uses: actions/checkout@v4

      - name: üîπ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: üîπ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        run: |
          pip install pyinstaller toml PyQt6

      - name: üîπ –ß—Ç–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏
        id: version
        run: |
          $version = Get-Content -Path VERSION -Encoding UTF8 | ForEach-Object { $_.Trim() }
          echo "RELEASE_VERSION=$version" >> $env:GITHUB_ENV
          echo "TAG_NAME=v$version" >> $env:GITHUB_ENV
        shell: pwsh

      - name: üîπ –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∫–∏
        run: |
          python build-tools/build.py
        shell: pwsh

      - name: üîπ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ä–µ–ª–∏–∑
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ env.TAG_NAME }}
          name: –í—ã–ø—É—Å–∫ ${{ env.TAG_NAME }}
          body: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±—Ä–∞–Ω–Ω—ã–π –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤
          files: dist/*.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
