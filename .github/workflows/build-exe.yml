name: üèóÔ∏è –°–±–æ—Ä–∫–∞ .exe

on:
  push:
    tags:
      - 'v*'

jobs:
  build-exe:
    runs-on: windows-latest
    strategy:
      matrix:
        python-version: ['3.11']

    steps:
      - name: üîπ Checkout –∫–æ–¥–∞
        uses: actions/checkout@v4

      - name: üîπ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}

      - name: üîπ –ß—Ç–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –∏–∑ VERSION
        id: version
        run: |
          VERSION=$(cat VERSION)
          echo "RELEASE_VERSION=$VERSION" >> $GITHUB_ENV
          echo "TAG_NAME=v$VERSION" >> $GITHUB_ENV
        shell: bash

      - name: üîπ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        run: |
          python -m pip install --upgrade pip
          pip install pyinstaller toml PyQt6

      - name: üîπ –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∫–∏ —á–µ—Ä–µ–∑ build.py
        run: |
          python build.py
        shell: pwsh

      - name: üîπ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ä–µ–ª–∏–∑
        uses: softprops/action-gh-release@v2
        if: success()
        with:
          tag_name: ${{ env.TAG_NAME }}
          name: –í—ã–ø—É—Å–∫ ${{ env.TAG_NAME }}
          body: |
            –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±—Ä–∞–Ω–Ω—ã–π –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤:

            - `–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä CSV-RDF.exe` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
            - `config.json` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

            –†–∞—Å–ø–∞–∫—É–π—Ç–µ –∞—Ä—Ö–∏–≤ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ .exe.

            –í–µ—Ä—Å–∏—è: ${{ env.RELEASE_VERSION }}
          draft: false
          prerelease: false
          files: |
            dist/–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä CSV-RDF_v*.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
