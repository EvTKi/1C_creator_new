name: üèóÔ∏è –°–±–æ—Ä–∫–∞ .exe –∏ –≤—ã–ø—É—Å–∫

on:
  push:
    branches: ['main', 'master']

jobs:
  build-exe:
    runs-on: windows-latest
    strategy:
      matrix:
        python-version: ['3.11']

    steps:
      - name: üîπ Checkout –∫–æ–¥–∞
        uses: actions/checkout@v4

      - name: üîπ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}

      - name: üîπ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        timeout-minutes: 10
        run: |
          python -m pip install --upgrade pip
          pip install --no-cache-dir -e .
          pip install --no-cache-dir PyQt6 pyinstaller toml

      - name: üîπ –°–±–æ—Ä–∫–∞ .exe —Å –ø–æ–º–æ—â—å—é PyInstaller
        run: |
          python -m PyInstaller  noconsole  onefile  name "–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä CSV-RDF"  add-data "config.json;."  distpath "dist" ^
            src/ui.py

      - name: üîπ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ config.json –≤ –ø–∞–ø–∫—É —Å .exe
        run: |
          mkdir dist/final
          copy config.json dist/final\config.json
          copy dist\–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä\ CSV-RDF.exe dist/final\–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä\ CSV-RDF.exe

      - name: üîπ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ .exe + config.json
        run: |
          cd dist/final
          zip -r ../converter-package.zip *

      - name: üîπ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–∞ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
        uses: softprops/action-gh-release@v2
        if: success()
        with:
          tag_name: v${{ env.RELEASE_VERSION }}
          name: –í—ã–ø—É—Å–∫ v${{ env.RELEASE_VERSION }}
          body: |
            –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±—Ä–∞–Ω–Ω—ã–π –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤:
            - `–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä CSV-RDF.exe`
            - `config.json`

            –ó–∞–ø—É—Å—Ç–∏—Ç–µ `.exe` ‚Äî –æ–Ω –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å `config.json` –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ.
          draft: false
          prerelease: false
          files: dist/converter-package.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          RELEASE_VERSION: ${{ github.run_number }}
